안녕하십니까 금주 redflavor 팀의 발표를 맡게 된 최윤수 입니다.

[ppt2]
금주 진행 사항에 대해 먼저 말씀 드리겠습니다.
[ppt3]
먼저 저번주에 말씀 드렸던 서버 충돌문제에 대해, 해결방안을 강구하였습니다.
그리고 원래 전주에 발표 하려 했었던 음성통신 문제에 대한 해결방안에 대해서 말씀드리겠습니다.
안드로이드 영역은 추가적으로 코드 영역을 보완 하였는데, 라즈베리 파이와 서버통신 시
몇 주간 테스트를 계속 진행 하였는데, 불 필요한 자바코드나 뷰 영역을 고쳤습니다.

[ppt4]
저희가 금주에 발표할 핵심 사항은 라즈베리파이의 서버영역입니다. 
금주동안 팀원끼리 다양한 아이디어를 공유하여 여러가지 해결방안을 마련하였습니다.
먼저 원인에 대해 설명을 해 드리겠습니다.

[ppt5]
보시는 그림과 같이, 라즈베리 파이에 카메라가 부착 돼 있고, 
라즈베리파이에는 데이터 송수신을 위한 소켓서버와,
영상을 스트리밍 하기 위한 스트리밍 서버, 총 2개가 존재합니다.
스트리밍 서버를 실행하면 카메라는 영상을 촬영하고, 
촬영된 영상을 네트워크를 통해 방송을 합니다.
이때 카메라는 스트리밍 서버에서 사용하고 있기 때문에 스트리밍 서버와 카메라가 부착이 되고,
다른 서버에서 사용을 하기위해 카메라에 접근을 요구할 시, 이미 카메라는 스트리밍 서버와
부착이 돼 있기 때문에, 다른 접근을 허용하지 않습니다.
따라서 서버가 충돌이 나는 것입니다.
반대로 소켓서버를 실행 한 후, 카메라와 소켓서버를 부착시키고, 스트리밍 서버를 실행하여도,
스트리밍 서버가 실행되지 않는 상황이 발생합니다.
따라서 저희는 다음과 같은 해결책을 제안하였습니다.

[ppt6]
첫번째 해결책입니다.
소켓 서버에서 카메라를 부착 시키려던 이유는 영상촬영 및 영상녹화 때문입니다.
하지만 영상촬영 및 녹화를 프론트엔드해서 하면 해결이 됩니다.
즉 웹,안드로이드,ios에서 각각 영상 촬영 및 영상 녹화를 하여 해결할 수 있습니다.
하지만 ios쪽에서 스트리밍중인 영상 촬영 및 영상 녹화를 하는 데 있어서
심화과정이 필요한 것으로 나타났습니다. 웹 영역에서는 아직 해결방안을 강구하고 있으며
안드로이드 영역 역시, 별도로 특수 라이브러리를 사용하여 영상 촬영 및 녹화, 저장을 
하여야 하는데, sqlite를 이용한 영상,사진 저장과 녹화기술을 별도로 구현해야 하는
어려움이 있습니다.


[ppt7]
두번째 해결책입니다.
라즈베리파이에서 별도로 가상 카메라를 실행하여 해결할 수 있을 것으로 예상합니다.
이 해결책은 앞서 말씀드린 서버충돌 원인을 해결할 수 있는 해결책으로 제안되었지만,
실제로 해결이 될 지에 대한 미지수와 가상카메라 구현이라는 별도 기술을 도입해야 하는
문제를 안고있어 대안책 중 하나로만 생각중입니다.

[ppt8]
세번째 해결책입니다.
스트리밍 서버에서 제공되는 영상을 촬영 및 녹화를 하여 저장할 수 있는 별도의 서버를 
구축하는 것입니다. 서버의 위치는 라즈베리파이영역이며, 이 서버의 역할은
스트리밍 된 사진 저장 및 녹화 서비스만 제공하며, 저장된 데이터는 별도로 백엔드로
ftp 통신을 통해 전송합니다. 혹은 백엔드에서 영상을 촬영 및 저장후 녹화를 한다면 
ftp 통신은 필요 없을것으로 보입니다. 세번째 해결의 문제점은 통신이 복잡해진다는 점입니다.
따라 역시 대안책 중 하나로 생각중입니다.

[ppt9]
네번째 해결책입니다.
기존 두개로 나눠진 소켓통신 서버와 스트리밍 서버를 하나의 서버로 통합하면 해결가능 할 것으로
보입니다. 두개의 서버를 하나로 통합하여 쓰레드를 통해 적절히 카메라 제어권을 소켓통신 영역과 
스트리밍 영역으로 분산시켜 충돌을 막을 수 있을 것으로 예상합니다. 그러나 미리 구현된 
스트리밍 라이브러리가 씨플플로 구현이 돼 있고 소켓서버는 파이썬으로 구현 돼 있기 때문에,
통합하기 위한 상당한 공부가 필요할 것으로 보입니다. 통합 후 적절히 제어권을 나눠 
충돌을 막는 과정에서 긴 시간이 소요될 것으로 보입니다.

[ppt10]
다섯번째 해결책입니다.
영상을 스트리밍 하면서 녹화 및 사진촬영을 하여 저장할 수 있는 라이브러리를 이용하는 것입니다.
정보를 찾던 도중 ffmpeg 라는 라이브러리를 찾게 되었고 현재 테스트 중입니다.
ffmpeg 라이브러리를 사용하더라도, 영상 스트리밍 시 딜레이가 심하면 구상안 중 에서 배제할 계획입니다.


[ppt11]
저희가 채택한 유력한 해결 방안은 첫번째 해결책인 프론트엔드 영역에서 촬영및 녹화후 저장하는
방식과, 네번째 해결책인 두개의 서버를 통합하여 해결하는 방법입니다. 
이 기술은 이번학기내에 시간적 여유문제로 구현이 어려울 것으로 보이며, 어떤 방법을 채택할 것인지
아직 팀 내 회의중입니다.

[ppt12]
다음으로 음성통신 문제입니다.
3월달 초에 uv4l을 이용하여 화상회의라는 기능을 통해 웹으로 실시간 음성대화를 테스트 한 바 있습니다.
이 기능을 라즈베리파이 상의 영상 스트리밍 서버와 동시에 구현하는 데 어려움이 많았습니다.
이 부분에 대해서 몇 주간 지속적으로 연구를 하였는데, 아직 해결이 되지 않았으며 
다음과 같은 해결책을 제시합니다.


[ppt13]
첫번째 해결책입니다.
소켓 음성 스트리밍 서버를 별도로 구축하는 것입니다. 
라즈베리 파이에서 음성과 영상 스트리밍 서버가 별도로 돌아가며,
이 과정에서 싱크가 맞지 않는 문제가 발생합니다.
현재 소켓음성 스트리밍 서버 구현을 위해 정보를 찾는 중이며, 소켓음성 스트리밍이 된다 하더라도,
싱크가 맞지 않는다면 제작안에 넣지 않을 계획입니다.


[ppt14]
두번 째 해결책입니다.
별도로 카메라와 마이크가 같이 부착된 모듈을 구입하는 방법입니다.
uv4l을 이용하여 영상과 음성을 동시에 구현을 하는 방법인데, 
웹 상으로는 가능하고 테스트도 해 보았지만, 
어플리케이션과 서버통신에도 적용이 될 지는 아직 미지수입니다.
별도로 웹과 ios 영역에서도 api가 적용되는지 테스트 전입니다.

[ppt15]
음성통신 문제는 두번째 해결책으로 방향을 잡았습니다.
그 이유는 첫번째 해결책인 소켓음성 통신 서버는 영상과 음성의 싱크가 맞지 않는다는
문제가 있기 때문입니다.

[ppt16]
이번주는 저희가 직면한 문제에 대해 되돌아보고 해결방안을 찾는 한주를 보냈습니다.
따라서 앞서 말씀드린 문제에 대한 해결이 보완점이 되겠습니다.

[ppt17]
발표는 여기까지 하겠습니다. 
혹시 질문이 있으시다면 질문 받겠습니다.

[ppt18]
감사합니다 이상 redflavor 의 최윤수였습니다.


모든 질문은 상언이형이 답하며
답을 못할 질문은 다음과 같이 답합니다

[답변]
해당 프론트 엔드 영역 담당자가 금일 개인사정으로 인하여
 수업에 불참해서 현재 답변이 어렵습니다.
질문은 별도로 메모하여 다음주에 답할 수 있도록 하겠습니다.


